<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Serial Test</title>
  <style>
    body { font-family: monospace; margin: 20px; }
    #output {
      border: 1px solid #ccc;
      padding: 10px;
      height: 300px;
      overflow-y: scroll;
      white-space: pre-wrap;
      background: #111;
      color: #0f0;
    }
    button { font-size: 16px; padding: 10px; }
  </style>
</head>
<body>

<h2>Serial UART Test</h2>

<button id="connectBtn">Connect to Serial Device</button>

<h3>Output</h3>
<div id="output"></div>

<script>
const connectBtn = document.getElementById("connectBtn");
const outputDiv = document.getElementById("output");

function log(text) {
  console.log(text);
  outputDiv.textContent += text;
  outputDiv.scrollTop = outputDiv.scrollHeight;
}

connectBtn.addEventListener("click", async () => {
  try {
    // Prompt user to select serial device
    const port = await navigator.serial.requestPort();

    // Open port (adjust baud rate for your TD1s)
    await port.open({ baudRate: 115200 });

    log("Connected.\n");

    const decoder = new TextDecoderStream();
    port.readable.pipeTo(decoder.writable);

    const reader = decoder.readable.getReader();

    // Read loop
    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      if (value) log(value);
    }

  } catch (err) {
    log("Error: " + err + "\n");
  }
});
</script>

</body>
</html>
